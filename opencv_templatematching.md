# OpenCV æ¨¡æ¿åŒ¹é…æºç è§£æ

[source code](https://github.com/opencv/opencv/blob/4.x/modules/imgproc/src/templmatch.cpp)

## å‡è®¾
- Source/Input - n x n
- Template - m x m
- Result/Output - (n-m+1) x (n-m+1)

## åŒ¹é…æ–¹æ³•
- `CV_TM_CCORR`æˆ–`CV_TM_CCORR_NORMED`
  - ç›¸å…³åŒ¹é…æ³• Cross Correlation
  - ç‚¹ç§¯:
    - å°†æ¯ä¸€å¯¹åƒç´ ç›¸ä¹˜
    - æ±‚å’Œæ‰€æœ‰ç‚¹ç§¯
- `CV_TM_CCOEFF`æˆ–`CV_TM_CCOEFF_NORMED`
  - ç›¸å…³ç³»æ•°åŒ¹é…æ³• Cross Coefficient
  - ç±»ä¼¼äºäº’ç›¸å…³ï¼Œä½†ç”¨å®ƒä»¬çš„åæ–¹å·®è¿›è¡Œäº†å½’ä¸€åŒ–
- `CV_TM_SQDIFF`æˆ–`CV_TM_SQDIFF_NORMED`
  - å¹³æ–¹å·®åŒ¹é…æ³• Sum of Square Differences (or SSD)
  - ç®€å•æ¬§æ°è·ç¦»(å¹³æ–¹)
    - å°†æ¯ä¸€å¯¹åƒç´ è¿›è¡Œç›¸å‡
    - å°†æ¯æ¬¡çš„ç›¸å‡ç»“æœå¹³æ–¹
    - æ±‚å’Œæ‰€æœ‰å¹³æ–¹
  - å¯¹äºå½’ä¸€åŒ–
    - åˆ†æ¯é¡¹ä¸ä¸Šé¢ç›¸åŒï¼Œä½†é™¤ä»¥ä¸€ä¸ªå› å­ï¼Œç”±ä¹˜ç§¯çš„å¹³æ–¹æ ¹è®¡ç®—å¾—åˆ°:
      - æ¨¡æ¿çš„å’Œçš„å¹³æ–¹
      - è¾“å…¥å›¾åƒçš„å’Œçš„å¹³æ–¹

[å‚è€ƒé“¾æ¥ 1](https://docs.opencv.org/3.4/df/dfb/group__imgproc__object.html#gga3a7850640f1fe1f58fe91a2d7583695dab65c042ed62c9e9e095a1e7e41fe2773)


[å‚è€ƒé“¾æ¥ 2](https://stackoverflow.com/questions/48799711/explain-difference-between-opencvs-template-matching-methods-in-non-mathematica)

## æ¨¡æ¿åŒ¹é…
```c++
void cv::matchTemplate(
    InputArray image, 
    InputArray templ, 
    OutputArray result, 
    int method, 
    InputArray mask = noArray()
)		
```
**åŸºæœ¬è¿‡ç¨‹ï¼š**
1. ä½¿ç”¨ Instrumentation framework æµ‹è¯•ç³»ç»Ÿæ€§èƒ½ï¼ˆå¯å¼€å¯å¯å…³é—­ï¼‰
2. åˆ†åˆ«è·å–è¾“å…¥å›¾åƒçš„ç±»å‹ã€æ·±åº¦å’Œé€šé“æ•°çš„å€¼
3. æ£€æŸ¥ method çš„å€¼æ˜¯å¦æ­£ç¡®
4. æ£€æŸ¥è¾“å…¥å›¾åƒçš„æ·±åº¦ï¼Œå³æ¯ä¸€ä¸ªåƒç´ çš„ä½æ•°ï¼ˆbitsï¼‰æ˜¯å¦ä¸º8ä½æˆ–32ä½
5. æ£€æŸ¥è¾“å…¥å›¾åƒçš„[ç±»å‹](https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html#af2d2652e552d7de635988f18a84b53e5)æ˜¯å¦å’Œæ¨¡æ¿å›¾åƒç›¸åŒ
6. æ£€æŸ¥è¾“å…¥å›¾åƒçš„ç»´åº¦æ˜¯å¦è¶…è¿‡äºŒç»´
7. å¦‚æœ mask çš„å€¼ä¸ä¸ºç©ºï¼Œè°ƒç”¨ `cv::matchTemplateMask(_img, _templ, _result, method, _mask)`
8. åˆ¤æ–­è¾“å…¥å›¾åƒä¸æ¨¡æ¿å›¾åƒçš„å¤§å°å…³ç³»ï¼Œå¦‚æœè¾“å…¥å›¾åƒæ¯”åŒ¹é…å›¾åƒå°ï¼Œåˆ™å°†åŸå§‹å›¾åƒä½œä¸ºæ¨¡æ¿ï¼ŒåŸæ¥çš„æ¨¡æ¿å›¾åƒä½œä¸ºæœç´¢å›¾
9. å¦‚æœè®¡ç®—æœºæ”¯æŒ OpenCL åŠŸèƒ½ï¼Œåˆ™è¿è¡Œ`ocl_matchTemplate()`ï¼Œè¯¥å‡½æ•°çš„å®ç°åœ¨ opencl_kernels_imgproc.hpp ä¸­ï¼›å¦‚æœä¸æ”¯æŒè¯¥åŠŸèƒ½ï¼Œåˆ™è¿è¡Œå¸¸è§„ä»£ç ï¼ˆCPUï¼‰
10. è®¡ç®—ç›¸å…³æ€§çŸ©é˜µå¤§å°ï¼Œå°† correlation size è®¾ç½®ä¸º result çš„å¤§å°ï¼Œå¹¶åˆ›å»º result `_result.create(corrSize, CV_32F)`ï¼Œåˆ›å»ºçš„ result ä¸­å„ä¸ªä½ç½®çš„å€¼ä¸º0
11. å¦‚æœè¯¥ç¨‹åºåœ¨ Intel å¤„ç†å™¨ä¸Šè¿è¡Œï¼Œåˆ™è°ƒç”¨`CV_IPP_RUN_FAST(ipp_matchTemplate(img, templ, result, method))`
12. è®¡ç®—äº’ç›¸å…³æ€§ï¼ˆCross Correlationï¼‰`crossCorr(img, templ, result, Point(0,0), 0, 0)`
13. è¿›è¡Œå¸¸è§„æ¨¡æ¿åŒ¹é…`common_matchTemplate(img, templ, result, method, cn)`

### CV_INSTRUMENT_REGION
[Instrumentation framework for OpenCV performance test system](https://github.com/opencv/opencv/pull/7101)
- è·Ÿè¸ªOpenCVå‡½æ•°å†…éƒ¨çš„å®ç°æ‰§è¡Œï¼Œå¹¶è¾“å‡ºåˆ°æµ‹è¯•æ—¥å¿—
- è·Ÿè¸ªåœ¨ç®¡é“ä¸­çš„æ‰§è¡Œæ—¶é—´æƒé‡
- å¯ä»¥å…³é—­ï¼Œå…³é—­åä¸æ¶ˆè€—èµ„æº

### CV_OCL_RUN
- OpenCLï¼ˆå…¨ç§° Open Computing Languageï¼Œå¼€æ”¾è¿ç®—è¯­è¨€ï¼‰æ˜¯ç¬¬ä¸€ä¸ªé¢å‘å¼‚æ„ç³»ç»Ÿé€šç”¨ç›®çš„å¹¶è¡Œç¼–ç¨‹çš„å¼€æ”¾å¼ã€å…è´¹æ ‡å‡†ã€‚
- OpenCL ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼Œä¸€æ˜¯ç”¨äºç¼–å†™ kernelsï¼ˆåœ¨ OpenCL è®¾å¤‡ä¸Šè¿è¡Œçš„å‡½æ•°ï¼‰çš„è¯­è¨€ï¼ŒäºŒæ˜¯ç”¨äºå®šä¹‰å¹¶æ§åˆ¶å¹³å°çš„ API (å‡½æ•°)ã€‚
- OpenCL æä¾›äº†åŸºäºä»»åŠ¡å’ŒåŸºäºæ•°æ®ä¸¤ç§å¹¶è¡Œè®¡ç®—æœºåˆ¶ï¼Œå®ƒæå¤§åœ°æ‰©å±•äº† GPU çš„åº”ç”¨èŒƒå›´ï¼Œä½¿ä¹‹ä¸å†å±€é™äºå›¾å½¢é¢†åŸŸã€‚
- æ‰€æœ‰ä¸“é—¨çš„ ocl å®ç°éƒ½éšè—åœ¨é€šç”¨çš„ C ç®—æ³•æ¥å£åé¢ã€‚ç°åœ¨å‡½æ•°çš„æ‰§è¡Œè·¯å¾„å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©ï¼šCPU æˆ– OpenCLï¼›è¿™ç§æœºåˆ¶ä¹Ÿè¢«ç§°ä¸ºâ€œé€æ˜APIâ€ã€‚
- å¦‚æœè®¡ç®—æœºä¸èƒ½ä½¿ç”¨ OpenCL åŠŸèƒ½ï¼ˆæ²¡æœ‰ GPU æˆ–æ²¡æœ‰ OpenCL é©±åŠ¨ç¨‹åºï¼‰ï¼Œåˆ™è¿è¡Œå¸¸è§„ä»£ç ï¼ˆCPUï¼‰ã€‚
- ä¹Ÿå¯ä»¥åœ¨å¸¸è§„ä»£ç ä¹‹é—´åˆ‡æ¢ï¼Œæˆ–åœ¨ä»£ç ä¸­ä½¿ç”¨ OpenCL ç‰ˆæœ¬ã€‚
- å¦‚æœ`setUseOptimized()`æˆ–`setUseOpenCL()`è®¾ç½®ä¸º falseï¼Œåˆ™å°†ä½¿ç”¨å¸¸è§„ä»£ç ã€‚
  
[å‚è€ƒé“¾æ¥ 1](https://stackoverflow.com/questions/42411157/what-is-the-macro-cv-ocl-run-used-for-in-opencv)


[å‚è€ƒé“¾æ¥ 2](https://docs.opencv.org/3.0-rc1/db/dfa/tutorial_transition_guide.html)


[å‚è€ƒé“¾æ¥ 3](https://blog.csdn.net/github_38148039/article/details/109469238)

### UMat
- ä¸€ä¸ªç»Ÿä¸€çš„æŠ½è±¡ cv::UMatï¼Œå…è®¸ä½¿ç”¨ CPU æˆ– OpenCL ä»£ç å®ç°ç›¸åŒçš„ APIï¼Œè€Œä¸éœ€è¦æ˜¾å¼è°ƒç”¨ OpenCL åŠ é€Ÿç‰ˆæœ¬ã€‚è¿™äº›åŠŸèƒ½å¦‚æœç³»ç»Ÿä¸­å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨æ”¯æŒ opencl çš„å›¾å½¢å¤„ç†å™¨ï¼Œå¦åˆ™ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ° CPU æ“ä½œã€‚
- ä¸€èˆ¬æ¥è¯´ï¼Œcv::UMat æ˜¯ C ç±»ï¼Œå’Œ cv::Mat éå¸¸ç›¸ä¼¼ã€‚ä½†æ˜¯å®é™…çš„ UMat æ•°æ®å¯ä»¥ä½äºå¸¸è§„ç³»ç»Ÿå†…å­˜ã€ä¸“ç”¨æ˜¾å­˜æˆ–å…±äº«å†…å­˜ä¸­ã€‚
- cv::UMat æ—¨åœ¨ä»¥ä¸€ç§æ–¹ä¾¿çš„æ–¹å¼éšè—ä¸ OpenCL è®¾å¤‡çš„æ•°æ®äº¤æ¢ã€‚

[å‚è€ƒé“¾æ¥ 1](https://stackoverflow.com/questions/33602675/what-is-the-difference-between-umat-and-mat-in-opencv)


[å‚è€ƒé“¾æ¥ 2](https://docs.opencv.org/3.0-rc1/db/dfa/tutorial_transition_guide.html)

### ä½¿ç”¨ IntelÂ® Integrated Performance Primitives (IPP) è¿›è¡ŒåŠ é€Ÿ
ippå…¨ç§°ï¼šIntelÂ® Integrated Performance Primitives è‹±ç‰¹å°”Â®é›†æˆæ€§èƒ½åŸè¯­ï¼ˆIntelÂ®IPPï¼‰ï¼Œå®ƒæ˜¯ä¸€ç§è½¯ä»¶åº“ï¼Œæä¾›äº†å¹¿æ³›çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬é€šç”¨ä¿¡å·å’Œå›¾åƒå¤„ç†ã€è®¡ç®—æœºè§†è§‰ã€æ•°æ®å‹ç¼©å’Œå­—ç¬¦ä¸²æ“ä½œã€‚

#### CV_IPP_RUN_FAST
å¦‚æœåœ¨è‹±ç‰¹å°”çš„å¤„ç†å™¨ä¸Šä½¿ç”¨ï¼ŒOpenCV å°±ä¼šè‡ªåŠ¨ä½¿ç”¨ä¸€ç§å…è´¹çš„è‹±ç‰¹å°”é›†æˆæ€§èƒ½åŸè¯­åº“ï¼ˆIPPï¼‰çš„å­é›†ï¼ŒIPP 8.x(IPPICV)ã€‚IPPICV å¯ä»¥åœ¨ç¼–è¯‘é˜¶æ®µé“¾æ¥åˆ° OpenCVï¼Œè¿™æ ·ä¸€æ¥ï¼Œä¼šæ›¿ä»£ç›¸åº”çš„ä½çº§ä¼˜åŒ–çš„ C è¯­è¨€ä»£ç ï¼ˆåœ¨ cmake ä¸­è®¾ç½®`WITH_IPP=ON/OFF`å¼€å¯æˆ–è€…å…³é—­è¿™ä¸€åŠŸèƒ½ï¼Œé»˜è®¤æƒ…å†µä¸ºå¼€å¯ï¼‰ã€‚ä½¿ç”¨ IPP è·å¾—çš„é€Ÿåº¦æå‡éå¸¸å¯è§‚ã€‚


[å‚è€ƒé“¾æ¥](https://blog.csdn.net/github_38148039/article/details/109469238)

#### ipp_matchTemplate
```c++
static bool ipp_matchTemplate(
    Mat& img, 
    Mat& templ, 
    Mat& result, 
    int method
)
```
**åŸºæœ¬è¿‡ç¨‹ï¼š**
1. åˆ¤æ–­è¾“å…¥å›¾åƒçš„é€šé“æ•°ä¸æ˜¯1ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› false
2. åˆ¤æ–­æ¨¡æ¿å‡½æ•°çš„å¤§å°æ˜¯å¦ä¸å›¾åƒå¤§å°ç›¸å½“ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¿”å› false
3. æ ¹æ®åŒ¹é…æ–¹æ³•è°ƒç”¨å¯¹åº”çš„å‡½æ•°

## è®¡ç®—äº’ç›¸å…³æ€§ï¼ˆCross Correlationï¼‰- å¿«é€Ÿå‚…é‡Œå¶å˜æ¢ï¼ˆFast Fourier Transformï¼‰
```c++
void crossCorr(
    const Mat& img, 
    const Mat& _templ, 
    Mat& corr,
    Point anchor, 
    double delta, 
    int borderType 
)
```

[å¦‚ä½•ç†è§£å‚…é‡Œå¶å˜æ¢](https://github.com/JasmineCAicai/Unique-Graphics/blob/master/FourierTransform.pdf)

kernel - template image

**ä¸»è¦è¿‡ç¨‹ï¼š**
1. è®¡ç®—å‡ºåˆé€‚çš„ dft åçš„çŸ©é˜µå¤§å°
2. è°ƒæ•´å›¾åƒå¤§å°ï¼Œå¡«å……å›¾åƒè¾¹ç¼˜
3. å°†æ ¸éƒ¨åˆ†è¿›è¡Œ dft æ“ä½œ
4. å°†åŸå›¾åƒè¿›è¡Œ dft æ“ä½œï¼Œå¹¶åœ¨é¢‘åŸŸç©ºé—´ä¸Šå°†åŸå›¾åƒä¸æ¨¡æ¿å›¾åƒç›¸ä¹˜ï¼Œè®¡ç®—ç›¸å…³æ€§
5. å°†å›¾åƒè¿˜åŸåˆ°åŸæ¥çš„å¤§å°ï¼ˆinverse DFTï¼‰

**åŸºæœ¬è¿‡ç¨‹ï¼š**
1. å®šä¹‰å˜é‡
   1. blockScale
   2. minBlockSize
   3. buf
   4. è¾“å…¥å›¾åƒã€æ¨¡æ¿å›¾åƒå’Œ corr å›¾åƒçš„æ·±åº¦
   5. è¾“å…¥å›¾åƒã€æ¨¡æ¿å›¾åƒå’Œ corr å›¾åƒçš„é€šé“æ•°é‡
2. æ£€æŸ¥è¾“å…¥å›¾åƒã€æ¨¡æ¿å›¾åƒå’Œ corr å›¾åƒçš„ç»´åº¦
3. æ£€æŸ¥æ¨¡æ¿å›¾åƒçš„æ·±åº¦æ˜¯å¦è¶…è¿‡é™åˆ¶ï¼Œå¦‚æœè¶…è¿‡ï¼Œå°†æ¨¡æ¿å›¾åƒçš„æ·±åº¦è½¬åŒ–æˆ CV_32F å’Œè¾“å…¥å›¾åƒæ·±åº¦ä¸­çš„æœ€å¤§å€¼
4. æ£€æŸ¥æ¨¡æ¿å›¾åƒçš„æ·±åº¦æ˜¯å¦ç¬¦åˆè¦æ±‚
5. æ£€æŸ¥ corr å›¾åƒçš„å¤§å°æ˜¯å¦ç¬¦åˆè¦æ±‚
6. è·å¾—æœ€å¤§æ·±åº¦å€¼ maxDepth
7. å£°æ˜å˜é‡
   1. blockSize
   2. dftsize
8. è®¡ç®— blockSize çš„ width å’Œ height
9. è°ƒç”¨å‡½æ•°`cv::getOptimalDFTSize`è®¡ç®— dftsize çš„ width å’Œ height
10. æ ¹æ® dftsize é‡æ–°è®¡ç®— blockSize
11. åˆ›å»º dftTempl å’Œ dftImg
12. å¦‚æœæ¨¡æ¿å›¾åƒçš„é€šé“æ•°å¤§äº1ä¸”æ¨¡æ¿å›¾åƒçš„æ·±åº¦ä¸æ˜¯æœ€å¤§æ·±åº¦ï¼Œåˆ™æ ¹æ®æ¨¡æ¿å¤§å°è®¡ç®— bufSize
13. å¦‚æœè¾“å…¥å›¾åƒçš„é€šé“æ•°å¤§äº1ä¸”è¾“å…¥å›¾åƒçš„æ·±åº¦ä¸æ˜¯æœ€å¤§æ·±åº¦ï¼Œåˆ™é‡æ–°è®¡ç®—å¹¶æ›´æ–° bufSize çš„å€¼
14. å¦‚æœ corr å›¾åƒçš„é€šé“æ•°å¤§äº1æˆ–è¾“å…¥å›¾åƒçš„é€šé“æ•°å¤§äº1ï¼Œä¸” corr å›¾åƒçš„æ·±åº¦ä¸æ˜¯æœ€å¤§æ·±åº¦ï¼Œåˆ™é‡æ–°è®¡ç®—å¹¶æ›´æ–° bufSize çš„å€¼
15. æ ¹æ® bufSize æ›´æ–° buf çš„å¤§å°
16. è®¡ç®—å„æ¨¡æ¿å¹³é¢çš„ DFT
    1.  å£°æ˜ç›¸å…³å˜é‡
        1.  yofs
        2.  src
        3.  dst
        4.  dst1
    2.  å¦‚æœæ¨¡æ¿å›¾åƒçš„é€šé“æ•°å¤§äº1ï¼Œå°† src è®¾ç½®ä¸º dst1ï¼Œå¹¶è°ƒç”¨`mixChannels(&templ, 1, &src, 1, pairs, 1)`å°†æŒ‡å®šçš„é€šé“åˆå¹¶åˆ°ç¬¬ä¸€ä¸ªé€šé“
    3.  å¦‚æœ src ä¸ç­‰äº dst1ï¼Œå°† src è®¾ç½®ä¸º dst1
    4.  å¦‚æœ dst çš„åˆ—æ•°å¤§äºæ¨¡æ¿å›¾åƒçš„åˆ—æ•°ï¼Œå°†å¤šå‡ºçš„åˆ—çš„å€¼è®¾ä¸º0
    5.  ä½¿ç”¨`c->apply(dst.data, (int)dst.step, dst.data, (int)dst.step)`å°†æ›´æ–°åçš„ dst åº”ç”¨åˆ°ä¹‹å‰åˆ›å»ºçš„ DFT2D çš„ç»“æ„ä¸Š
17. å®šä¹‰å˜é‡
    1.  tileCountX
    2.  tileCountY
    3.  tileCount
    4.  wholeSize
    5.  roiofs
    6.  img0
18. åˆ¤æ–­è¾¹ç•Œç±»å‹ï¼Œå¦‚æœ`borderType & BORDER_ISOLATED`ä¸º0ï¼Œåˆ™è°ƒæ•´å­çŸ©é˜µçš„å¤§å°å¹¶å®šä½å…¶åœ¨çˆ¶çŸ©é˜µä¸­çš„ä½ç½®
19. å®šä¹‰å˜é‡
    1.  cF
    2.  cR
    3.  f
    4.  f_inv
20. æŒ‰å—è®¡ç®—ç›¸å…³æ€§
    1.  å°† dftIm çš„å€¼å¡«å……ä¸º0
    2.  å®šä¹‰å˜é‡
        1.  xï¼Œy
        2.  bszï¼Œdsz
        3.  x0ï¼Œy0
        4.  x1ï¼Œy1
        5.  x2ï¼Œy2
        6.  src0ï¼Œdstï¼Œdst1ï¼Œcdst
    3.  å¦‚æœè¾“å…¥å›¾åƒçš„é€šé“æ•°å¤§äº1ï¼Œåˆ™æ··åˆé€šé“
    4.  å¦‚æœ src ä¸ç­‰äº dftImgï¼Œåˆ™å°† src è®¾ç½®ä¸º dftImg
    5.  å¦‚æœè£å‰ªåçš„å›¾åƒæ›´å°ï¼Œè°ƒç”¨`copyMakeBorder(dst1, dst, y1-y0, dst.rows-dst1.rows-(y1-y0), x1-x0, dst.cols-dst1.cols-(x1-x0), borderType)`è¿›è¡Œè¾¹ç•Œå¡«å……
    6.  å¦‚æœ bsz çš„é«˜ç­‰äºå—çš„é«˜ï¼Œåˆ™`cF->apply(dftImg.data, (int)dftImg.step, dftImg.data, (int)dftImg.step)`ï¼›åä¹‹å¯¹ dftImg æ‰§è¡Œæ­£å‘å‚…é‡Œå¶å˜æ¢
    7.  å®šä¹‰ dftTempl1
    8.  è°ƒç”¨`mulSpectrums(dftImg, dftTempl1, dftImg, 0, true)`å¯¹é¢‘åŸŸç©ºé—´ä¸Šçš„å…ƒç´ ç›¸ä¹˜
    9.  å¦‚æœ bsz çš„é«˜ç­‰äºå—çš„é«˜ï¼Œåˆ™`cR->apply(dftImg.data, (int)dftImg.step, dftImg.data, (int)dftImg.step)`ï¼›åä¹‹å¯¹ dftImg æ‰§è¡Œåå‘å‚…é‡Œå¶å˜æ¢
    10. é‡æ–°å®šä¹‰ src
    11. å¦‚æœ corr å›¾åƒçš„é€šé“æ•°å¤§äº1ï¼Œåœ¨ corr å›¾åƒçš„æ·±åº¦ä¸æ˜¯æœ€å¤§æ·±åº¦æ—¶æ›´æ–° srcï¼Œæ¥ç€æ··åˆé€šé“ï¼›åä¹‹å¦‚æœå½“å‰æ‰€åœ¨é€šé“ä¸ºè¾“å…¥å›¾åƒçš„ç¬¬ä¸€é€šé“ï¼Œå°† src è½¬æ¢ä¸º cdstï¼Œå¦åˆ™
        1.  å¦‚æœ corr å›¾åƒçš„æ·±åº¦ä¸æ˜¯æœ€å¤§æ·±åº¦ï¼Œæ›´æ–° src
        2.  è°ƒç”¨`add(src, cdst, cdst)`ä½¿ src å’Œ cdst çš„å…ƒç´ åˆ†åˆ«ç›¸åŠ 

- å¯¹ dft çš„ä¼˜åŒ–ï¼šä½¿ç”¨ tile
  - ç”±äº`nonzeroRows != 0`è¢«ä¼ é€’ç»™å‰å‘è½¬æ¢è°ƒç”¨ï¼ˆforward transform callsï¼‰ï¼Œå¹¶ä¸” A å’Œ B åˆ†åˆ«è¢«å¤åˆ¶åˆ° tempA å’Œ tempB çš„å·¦ä¸Šè§’ï¼Œå› æ­¤ä¸éœ€è¦æ¸…é™¤æ•´ä¸ª tempA å’Œ tempBã€‚åªéœ€è¦æ¸…é™¤`tempA.cols - A.cols` (`tempB.cols - B.cols`)çŸ©é˜µçš„æœ€å³åˆ—ã€‚
  - è¿™ç§åŸºäº dft çš„å·ç§¯ä¸éœ€è¦åº”ç”¨åˆ°æ•´ä¸ªå¤§æ•°ç»„ï¼Œç‰¹åˆ«æ˜¯å¦‚æœ B æ˜æ˜¾å°äº A æˆ–åä¹‹äº¦ç„¶ã€‚ç›¸åï¼Œå¯ä»¥ç”¨åˆ†éƒ¨åˆ†æ¥è®¡ç®—å·ç§¯ã€‚ä¸ºæ­¤ï¼Œéœ€è¦å°†è¾“å‡ºæ•°ç»„Cæ‹†åˆ†ä¸ºå¤šä¸ª tileã€‚
  - å¯¹äºæ¯ä¸ª tileï¼Œä¼°è®¡ A å’Œ B çš„å“ªäº›éƒ¨åˆ†éœ€è¦åœ¨è¿™ä¸ª tile ä¸­è®¡ç®—å·ç§¯ã€‚å¦‚æœ C ä¸­çš„ tiles å¤ªå°ï¼Œç”±äºé‡å¤çš„å·¥ä½œï¼Œé€Ÿåº¦ä¼šä¸‹é™å¾ˆå¤šã€‚åœ¨æœ€ç»ˆçš„æƒ…å†µä¸‹ï¼Œå½“ C ä¸­çš„æ¯ä¸ª tile éƒ½æ˜¯å•ä¸ªåƒç´ æ—¶ï¼Œè¯¥ç®—æ³•å°±ç­‰ä»·äºæœ´ç´ çš„å·ç§¯ç®—æ³•ã€‚
  - å¦‚æœç£è´´å¤ªå¤§ï¼Œä¸´æ—¶æ•°ç»„ tempA å’Œ tempB å°±ä¼šå˜å¾—å¤ªå¤§ï¼Œè€Œä¸”ç”±äºç³Ÿç³•çš„ç¼“å­˜å±€éƒ¨æ€§ï¼Œé€Ÿåº¦ä¹Ÿä¼šå˜æ…¢ã€‚æ‰€ä»¥ï¼Œåœ¨è¿™ä¸¤è€…ä¹‹é—´å­˜åœ¨ä¸€ä¸ªæœ€ä½³çš„è´´å›¾å¤§å°ã€‚
- å¦‚æœ C è¯­è¨€ä¸­ä¸åŒçš„å¹³é“ºå—å¯ä»¥å¹¶è¡Œè®¡ç®—ï¼Œå› æ­¤ï¼Œå·ç§¯æ˜¯ç”±éƒ¨åˆ†å®Œæˆçš„ï¼Œé‚£ä¹ˆå¾ªç¯å°±å¯ä»¥è¢«çº¿ç¨‹åŒ–ã€‚

### cvRound
å°†æµ®ç‚¹æ•°èˆå…¥åˆ°æœ€æ¥è¿‘çš„æ•´æ•°ã€‚

### è·å– DFT çš„æœ€ä½³å¤§å°
DFT - Discrete Fourier Transform
```c++
int cv::getOptimalDFTSize(int vecsize)
```
- è¿”å›ç»™å®šçŸ¢é‡å¤§å°çš„æœ€ä½³DFTå¤§å°ã€‚
- DFTæ€§èƒ½ä¸æ˜¯ä¸€ä¸ªçŸ¢é‡å¤§å°çš„å•è°ƒå‡½æ•°ã€‚å› æ­¤ï¼Œå½“è®¡ç®—ä¸¤ä¸ªé˜µåˆ—çš„å·ç§¯æˆ–æ‰§è¡Œä¸€ä¸ªé˜µåˆ—çš„å…‰è°±åˆ†ææ—¶ï¼Œé€šå¸¸æœ‰æ„ä¹‰çš„æ˜¯ç”¨0å¡«å……è¾“å…¥æ•°æ®ï¼Œä»¥è·å¾—æ›´å¤§çš„é˜µåˆ—ï¼Œå¯ä»¥æ¯”åŸå§‹é˜µåˆ—è½¬æ¢å¿«å¾—å¤šã€‚
  - å¤§å°ä¸º2çš„å¹‚æ¬¡(2ã€4ã€8ã€16ã€32ï¼Œâ€¦)çš„æ•°ç»„å¤„ç†é€Ÿåº¦æœ€å¿«ã€‚
  - ä¸è¿‡ï¼Œå¯¹äºå¤§å°ä¸º2ã€3å’Œ5çš„ä¹˜ç§¯çš„æ•°ç»„(ä¾‹å¦‚ï¼Œ300 = 5*5*3*2*2)ï¼Œå¤„ç†èµ·æ¥ä¹Ÿç›¸å½“é«˜æ•ˆã€‚
- å‡½æ•°`cv::getOptimalDFTSize`è¿”å›å¤§äºæˆ–ç­‰äº vecsize çš„æœ€å°æ•°å­— Nï¼Œä»¥ä¾¿æœ‰æ•ˆåœ°å¤„ç†å¤§å°ä¸ºNçš„å‘é‡çš„ DFTã€‚åœ¨å½“å‰çš„å®ç°ä¸­ N = 2 ^p^ * 3 ^q^ * 5 ^r^ å¯¹äºæŸä¸ªæ•´æ•° p, q, rã€‚
- å¦‚æœ vecsize å¤ªå¤§(éå¸¸æ¥è¿‘ INT_MAX)ï¼Œå‡½æ•°è¿”å›ä¸€ä¸ªè´Ÿæ•°ã€‚

### CV_ELEM_SIZE
è®¡ç®—æ¯ä¸ªåƒç´ ç‚¹æ‰€éœ€çš„å­—èŠ‚æ€»æ•°

### æ··åˆé€šé“ Mix Channels
```c++
void cv::mixChannels(
    const Mat * src,
    size_t nsrcs,
    Mat * dst,
    size_t ndsts,
    const int * fromTo,
    size_t npairs 
)
```
å°†æŒ‡å®šçš„é€šé“ä»è¾“å…¥æ•°ç»„å¤åˆ¶åˆ°è¾“å‡ºæ•°ç»„çš„æŒ‡å®šé€šé“ã€‚


ä¾‹å­ï¼š
```c++
Mat bgra( 100, 100, CV_8UC4, Scalar(255,0,0,255) );
Mat bgr( bgra.rows, bgra.cols, CV_8UC3 );
Mat alpha( bgra.rows, bgra.cols, CV_8UC1 );
// forming an array of matrices is a quite efficient operation,
// because the matrix data is not copied, only the headers
Mat out[] = { bgr, alpha };
// bgra[0] -> bgr[2], bgra[1] -> bgr[1],
// bgra[2] -> bgr[0], bgra[3] -> alpha[0]
int from_to[] = { 0,2, 1,1, 2,0, 3,3 };
mixChannels( &bgra, 1, out, 2, from_to, 4 );
```

### DFT2D apply()
```c++
virtual void cv::hal::DFT2D::apply(
    const uchar * src_data,
    size_t src_step,
    uchar * dst_data,
    size_t dst_step 
)
```

### è¾¹ç•Œç±»å‹ BORDER_ISOLATED 16

### è°ƒæ•´ROI
```c++
void cv::Mat::locateROI(
    Size & wholeSize,
    Point & ofs 
) const
```
- å®šä½çˆ¶çŸ©é˜µä¸­çš„çŸ©é˜µæ ‡å¤´ã€‚
- åœ¨ä½¿ç”¨ Mat::row, Mat::col, Mat::rowRange, Mat::colRange å’Œå…¶ä»–æ–¹æ³•ä»çŸ©é˜µä¸­æå–å­çŸ©é˜µä¹‹åï¼Œç”Ÿæˆçš„å­çŸ©é˜µåªæŒ‡å‘åŸå§‹å¤§çŸ©é˜µçš„ä¸€éƒ¨åˆ†ã€‚ä½†æ˜¯ï¼Œæ¯ä¸ªå­çŸ©é˜µåŒ…å«ä¿¡æ¯(ç”± datastart å’Œ dataend å­—æ®µè¡¨ç¤º)ï¼Œè¿™äº›ä¿¡æ¯æœ‰åŠ©äºé‡å»ºåŸå§‹çŸ©é˜µçš„å¤§å°å’Œæå–çš„å­çŸ©é˜µåœ¨åŸå§‹çŸ©é˜µä¸­çš„ä½ç½®ã€‚locateROI æ–¹æ³•å°±æ˜¯è¿™ä¹ˆåšçš„ã€‚
```c++
Mat& cv::Mat::adjustROI(
    int dtop,
    int dbottom,
    int dleft,
    int dright 
)
```
- è°ƒæ•´å­çŸ©é˜µçš„å¤§å°å’Œåœ¨çˆ¶çŸ©é˜µä¸­çš„ä½ç½®ã€‚
- è¯¥æ–¹æ³•æ˜¯ Mat::locateROI çš„é™„èµ æ–¹æ³•ã€‚
- è¿™äº›å‡½æ•°çš„å…¸å‹ç”¨é€”æ˜¯ç¡®å®šå­çŸ©é˜µåœ¨çˆ¶çŸ©é˜µä¸­çš„ä½ç½®ï¼Œç„¶åä»¥æŸç§æ–¹å¼ç§»åŠ¨ä½ç½®ã€‚
- é€šå¸¸ï¼Œå½“éœ€è¦è€ƒè™‘ ROI ä¹‹å¤–çš„åƒç´ æ—¶ï¼Œè¿‡æ»¤æ“ä½œå¯èƒ½éœ€è¦å®ƒã€‚å½“æ‰€æœ‰æ–¹æ³•å‚æ•°éƒ½ä¸ºæ­£æ—¶ï¼ŒROI éœ€è¦å‘å„ä¸ªæ–¹å‘å¢é•¿æŒ‡å®šçš„æ•°é‡ã€‚
  - ä¾‹å¦‚:`A.adjustROI(2, 2, 2, 2);`
  - åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒçŸ©é˜µçš„å¤§å°åœ¨æ¯ä¸ªæ–¹å‘ä¸Šå¢åŠ äº†4ä¸ªå…ƒç´ 
  - çŸ©é˜µå‘å·¦ç§»åŠ¨2ä¸ªå…ƒç´ ï¼Œå‘ä¸Šç§»åŠ¨2ä¸ªå…ƒç´ ï¼Œè¿™ä¸º5x5å†…æ ¸çš„è¿‡æ»¤å¸¦æ¥äº†æ‰€æœ‰å¿…è¦çš„åƒç´ ã€‚
- adjustROI å¼ºåˆ¶åœ¨çˆ¶çŸ©é˜µå†…è°ƒæ•´ ROIï¼Œå³è°ƒæ•´ ROI çš„è¾¹ç•Œå—çˆ¶çŸ©é˜µè¾¹ç•Œçš„çº¦æŸã€‚
  - ä¾‹å¦‚ï¼Œå¦‚æœå­çŸ©é˜µ A ä½äºçˆ¶çŸ©é˜µçš„ç¬¬ä¸€è¡Œï¼Œè°ƒç”¨`A.adjustroi(2,2,2,2)`é‚£ä¹ˆ A ä¸ä¼šå‘ä¸Šå¢åŠ ã€‚


[å‚è€ƒé“¾æ¥ locateROI](https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html#a40b5b3371a9c2a4b2b8ce0c8068d7c96)


[å‚è€ƒé“¾æ¥ adjustROI](https://docs.opencv.org/3.4/d3/d63/classcv_1_1Mat.html#a2fece3507ee7e1284deee6da99e76b9b)

### CV_HAL_DFT_IS_INPLACE 1024
### CV_HAL_DFT_INVERSE 1
### CV_HAL_DFT_SCALE 2
### CV_HAL_DFT_IS_INPLACE | CV_HAL_DFT_INVERSE | CV_HAL_DFT_SCALE 1027

### å¡«å……å›¾ç‰‡è¾¹ç•Œ
```c++
void cv::copyMakeBorder(
    InputArray src,
    OutputArray dst,
    int top,
    int bottom,
    int left,
    int right,
    int borderType,
    const Scalar & value = Scalar() 
)
```
- åœ¨å›¾åƒå‘¨å›´å½¢æˆè¾¹æ¡†ã€‚
- è¯¥å‡½æ•°å°†æºå›¾åƒå¤åˆ¶åˆ°ç›®æ ‡å›¾åƒçš„ä¸­é—´ã€‚å¤åˆ¶æºå›¾åƒçš„å·¦è¾¹ã€å³è¾¹ã€ä¸Šé¢å’Œä¸‹é¢çš„åŒºåŸŸå°†è¢«å¤–æ¨åƒç´ å¡«å……ã€‚è¿™å¹¶ä¸æ˜¯åŸºäºå®ƒçš„è¿‡æ»¤å‡½æ•°æ‰€åšçš„(å®ƒä»¬åŠ¨æ€åœ°æ¨æ–­åƒç´ )ï¼Œè€Œæ˜¯å…¶ä»–æ›´å¤æ‚çš„å‡½æ•°ï¼ŒåŒ…æ‹¬ç”¨æˆ·è‡ªå·±çš„å‡½æ•°ï¼Œå¯èƒ½ä¼šåšçš„æ¥ç®€åŒ–å›¾åƒè¾¹ç•Œå¤„ç†ã€‚
- å½“æºå›¾åƒæ˜¯å¤§å›¾åƒçš„ä¸€éƒ¨åˆ†(ROI)æ—¶ï¼Œå‡½æ•°ä¼šå°è¯•ä½¿ç”¨ ROI å¤–çš„åƒç´ æ¥å½¢æˆè¾¹ç•Œã€‚è¦ç¦ç”¨æ­¤ç‰¹æ€§å¹¶å§‹ç»ˆè¿›è¡Œå¤–æ¨ï¼Œå°±åƒå¦‚æœ src ä¸æ˜¯ ROI ä¸€æ ·ï¼Œè¯·ä½¿ç”¨borderType | BORDER_ISOLATEDã€‚

[å‚è€ƒé“¾æ¥](https://docs.opencv.org/3.4/d2/de8/group__core__array.html#ga2ac1049c2c3dd25c2b41bffe17658a36)


### dft
```c++
void cv::dft(
    InputArray src,
    OutputArray dst,
    int flags = 0,
    int nonzeroRows = 0
)
```
[å‚è€ƒé“¾æ¥](https://docs.opencv.org/4.x/d2/de8/group__core__array.html#gadd6cf9baf2b8b704a11b5f04aaf4f39d)


### å‚…é‡Œå¶å…‰è°±å…ƒç´ ç›¸ä¹˜
```c++
void cv::mulSpectrums(
    InputArray a,
    InputArray b,
    OutputArray c,
    int flags,
    bool conjB = false
)
```
- æ‰§è¡Œä¸¤ä¸ªå‚…é‡Œå¶å…‰è°±çš„æ¯ä¸ªå…ƒç´ ç›¸ä¹˜ã€‚
- mulSpectrums å‡½æ•°æ‰§è¡Œä¸¤ä¸ª ccs å¡«å……çš„æˆ–å¤æ‚çš„çŸ©é˜µçš„æ¯ä¸ªå…ƒç´ çš„ä¹˜æ³•ï¼Œè¿™äº›çŸ©é˜µæ˜¯ä¸€ä¸ªå®çš„æˆ–å¤æ‚çš„å‚…é‡Œå¶å˜æ¢çš„ç»“æœã€‚
- è¯¥å‡½æ•°ä¸ dft å’Œ idft ä¸€èµ·ï¼Œå¯ç”¨äºå¿«é€Ÿè®¡ç®—ä¸¤ä¸ªæ•°ç»„çš„å·ç§¯(ä¼ é€’ conjB=false)æˆ–ç›¸å…³æ€§(ä¼ é€’ conjB=true)ã€‚å½“æ•°ç»„æ˜¯å¤æ•°æ•°ç»„æ—¶ï¼Œåªéœ€å°†å®ƒä»¬(æ¯ä¸ªå…ƒç´ )ä¸ç¬¬äºŒæ•°ç»„å…ƒç´ çš„å¯é€‰å…±è½­ç›¸ä¹˜ã€‚å½“æ•°ç»„æ˜¯çœŸå®çš„æ—¶ï¼Œå®ƒä»¬è¢«å‡å®šä¸º ccs å°è£…(è¯¦è§ dft)ã€‚

[å‚è€ƒé“¾æ¥](https://docs.opencv.org/3.4/d2/de8/group__core__array.html#ga3ab38646463c59bf0ce962a9d51db64f)

### å…ƒç´ ç›¸åŠ 
```c++
void cv::add(
    InputArray src1,
    InputArray src2,
    OutputArray dst,
    InputArray mask = noArray(),
    int dtype = -1
)
```
- è®¡ç®—ä¸¤ä¸ªæ•°ç»„æˆ–ä¸€ä¸ªæ•°ç»„å’Œä¸€ä¸ªæ ‡é‡çš„æ¯ä¸ªå…ƒç´ çš„å’Œã€‚
- å‡½æ•° add è®¡ç®—:
  - å½“ä¸¤ä¸ªè¾“å…¥æ•°ç»„å…·æœ‰ç›¸åŒçš„å¤§å°å’Œç›¸åŒçš„é€šé“æ•°æ—¶ï¼Œä¸¤ä¸ªæ•°ç»„çš„å’Œ:
ğšğšœğš(I)=ğšœğšŠğšğšğš›ğšŠğšğš(ğšœğš›ğšŒğŸ·(I)+ğšœğš›ğšŒğŸ¸(I))ğš’ğš ğš–ğšŠğšœğš”(I)â‰ 0
  - å½“ src2 ç”± scalar æ„é€ æˆ–å…·æœ‰ä¸ src1.channels() ç›¸åŒæ•°é‡çš„å…ƒç´ æ—¶ï¼Œæ•°ç»„å’Œæ ‡é‡çš„å’Œ:
ğšğšœğš(I)=ğšœğšŠğšğšğš›ğšŠğšğš(ğšœğš›ğšŒğŸ·(I)+ğšœğš›ğšŒğŸ¸)ğš’ğš ğš–ğšŠğšœğš”(I)â‰ 0
  - å½“ç”± scalar æ„é€ çš„ src1 æˆ–ä¸ src2.channels() å…·æœ‰ç›¸åŒæ•°é‡çš„å…ƒç´ æ—¶ï¼Œæ ‡é‡å’Œæ•°ç»„çš„å’Œ:
ğšğšœğš(I)=ğšœğšŠğšğšğš›ğšŠğšğš(ğšœğš›ğšŒğŸ·+ğšœğš›ğšŒğŸ¸(I))ğš’ğš ğš–ğšŠğšœğš”(I)â‰ 0
  - å…¶ä¸­ I æ˜¯æ•°ç»„å…ƒç´ çš„å¤šç»´ç´¢å¼•ã€‚å¯¹äºå¤šé€šé“é˜µåˆ—ï¼Œæ¯ä¸ªé€šé“ç‹¬ç«‹å¤„ç†ã€‚
- è¾“å…¥æ•°ç»„å’Œè¾“å‡ºæ•°ç»„éƒ½å¯ä»¥å…·æœ‰ç›¸åŒæˆ–ä¸åŒçš„æ·±åº¦ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥å°†16ä½æ— ç¬¦å·æ•°ç»„æ·»åŠ åˆ°8ä½æœ‰ç¬¦å·æ•°ç»„ä¸­ï¼Œå¹¶å°†å…¶å’Œå­˜å‚¨ä¸º32ä½æµ®ç‚¹æ•°ç»„ã€‚è¾“å‡ºæ•°ç»„çš„æ·±åº¦ç”± dtype å‚æ•°å†³å®šã€‚åœ¨ä¸Šé¢çš„ç¬¬äºŒç§å’Œç¬¬ä¸‰ç§æƒ…å†µä¸‹ï¼Œä»¥åŠåœ¨ç¬¬ä¸€ç§æƒ…å†µä¸‹ï¼Œå½“`src1.depth() == src2.depth()`æ—¶ï¼Œdtype å¯ä»¥è®¾ç½®ä¸ºé»˜è®¤çš„-1ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œè¾“å‡ºæ•°ç»„å°†å…·æœ‰ä¸è¾“å…¥æ•°ç»„ç›¸åŒçš„æ·±åº¦ï¼Œæ— è®ºæ˜¯ src1ã€src2 è¿˜æ˜¯ä¸¤è€…éƒ½æ˜¯ã€‚
  - ä¸¤ä¸ªå›¾åƒåº”è¯¥å…·æœ‰ç›¸åŒçš„æ·±åº¦å’Œç±»å‹ï¼Œæˆ–è€…ç¬¬äºŒä¸ªå›¾åƒå¯ä»¥åªæ˜¯ä¸€ä¸ªæ ‡é‡å€¼ã€‚
- å½“è¾“å‡ºé˜µåˆ—çš„æ·±åº¦ä¸º CV_32S æ—¶ï¼Œä¸åº”ç”¨é¥±å’Œã€‚åœ¨æº¢å‡ºçš„æƒ…å†µä¸‹ï¼Œç”¨æˆ·ç”šè‡³å¯èƒ½ä¼šå¾—åˆ°ä¸æ­£ç¡®çš„ç¬¦å·çš„ç»“æœã€‚
- OpenCV åŠ æ³•å’Œ Numpy åŠ æ³•ä¹‹é—´æ˜¯æœ‰åŒºåˆ«çš„ã€‚OpenCV åŠ æ³•æ˜¯ä¸€ä¸ªé¥±å’Œæ“ä½œï¼Œè€Œ Numpy åŠ æ³•æ˜¯ä¸€ä¸ªæ¨¡æ“ä½œã€‚ä¾‹å¦‚ï¼š
    ```c++
    >>> x = np.uint8([250])
    >>> y = np.uint8([10])
    >>> print( cv.add(x,y) ) # 250+10 = 260 => 255
    [[255]]
    >>> print( x+y )          # 250+10 = 260 % 256 = 4
    [4]
    ```

[å‚è€ƒé“¾æ¥ 1](https://docs.opencv.org/3.4/d0/d86/tutorial_py_image_arithmetics.html)


[å‚è€ƒé“¾æ¥ 2](https://docs.opencv.org/3.4/d2/de8/group__core__array.html#ga10ac1bfb180e2cfda1701d06c24fdbd6)


## å¸¸è§„æ¨¡æ¿åŒ¹é…
```c++
static void common_matchTemplate(
    Mat& img,
    Mat& templ,
    Mat& result,
    int method,
    int cn
)
```
**åŸºæœ¬è¿‡ç¨‹ï¼š**
1. å®šä¹‰å˜é‡
   1. numType
   2. isNormed
   3. invArea
   4. sum, sqsum
   5. templMean, templSdv
   6. q0, q1, q2, q3
   7. templNorm, templSum2
2. å¦‚æœæ–¹æ³•ä¸º CCOEFFï¼Œè°ƒç”¨`integral(img, sum, CV_64F)`è®¡ç®—è¾“å…¥å›¾åƒçš„ç§¯åˆ†ï¼Œå¹¶è®¡ç®—æ¨¡æ¿å›¾åƒçš„å¹³å‡å€¼ï¼›åä¹‹
   1. è®¡ç®—è¾“å…¥å›¾åƒçš„ç§¯åˆ†å’Œå¹³æ–¹ç§¯åˆ†
   2. è®¡ç®—æ¨¡æ¿å›¾åƒçš„å¹³å‡å€¼å’Œæ ‡å‡†å·®
   3. è®¡ç®—æ–¹å·®
   4. å¦‚æœæ–¹å·®å°äºä¸€å®šå€¼ï¼Œä¸”æ–¹æ³•ä¸ºCCOEFF_NORMEDï¼Œå°† result çš„å„ä¸ªä½ç½®ä¸Šçš„æ•°å€¼å…¨éƒ¨è®¾ç½®ä¸º1ï¼Œå¹¶è¿”å›
   5. è®¡ç®—å¹³æ–¹çš„å‡å€¼ templSum2
   6. å¦‚æœæ–¹æ³•ä¸æ˜¯ CCOEFFï¼Œåˆ™å°†æ¨¡æ¿å¹³å‡å€¼è®¾ç½®ä¸º0ï¼Œå¹¶å°† templNorm è®¾ç½®ä¸ºå¹³æ–¹çš„å‡å€¼
   7. `templSum2 /= invArea;`
   8. `templNorm = std::sqrt(templNorm);`
   9. `templNorm /= std::sqrt(invArea);`
   10. å®šä¹‰å˜é‡ q0, q1, q2, q3
3. å®šä¹‰å˜é‡
   1. p0, p1, p2, p3
   2. sumstep
   3. sqstep
   4. i, j, k
4. éå†ä¹‹å‰å®šä¹‰çš„ result å¹¶è®¡ç®—ç»“æœ
   1. å®šä¹‰å˜é‡
      1. rrow
      2. idx, idx2
      3. num
      4. wndMean2, wndSum2
   2. å¦‚æœæ–¹æ³•ä¸º CCOEFF
      1. æ ¹æ®é€šé“æ•°é‡ï¼Œåˆ†åˆ«
         1. è®¡ç®—å¾…æ£€æµ‹çš„åŒºåŸŸçš„ç§¯åˆ†
         2. `wndMean2 += t*t;`
         3. `num -= t*templMean[k];`
      2. `wndMean2 *= invArea;`
   3. å¦‚æœæ–¹æ³•ä¸º Normed æˆ– SQDIFF
      1. æ ¹æ®é€šé“æ•°é‡ï¼Œåˆ†åˆ«
         1. è®¡ç®—å¾…æ£€æµ‹çš„åŒºåŸŸçš„å¹³æ–¹ç§¯åˆ†ï¼ˆï¼Ÿ
         2. `wndSum2 += t;`
      2. å¦‚æœæ–¹æ³•ä¸º SQDIFFï¼Œæ ¹æ®å…¬å¼ï¼Œè®¡ç®—`num = wndSum2 - 2*num + templSum2`ï¼Œå¹¶æ›´æ–°`num = MAX(num, 0.)`
   4. å¦‚æœæ–¹æ³•ä¸º Normed
      1. å®šä¹‰å˜é‡`diff2 = MAX(wndSum2 - wndMean2, 0)`
      2. å¦‚æœ diff2 çš„å€¼å°äºä¸€å®šå€¼ï¼Œä¸ºäº†é¿å…èˆå…¥è¯¯å·®ï¼Œ`t = 0`ï¼›åä¹‹`t = std::sqrt(diff2)*templNorm`
      3. å¦‚æœ`fabs(num) < t`ï¼Œåˆ™`num /= t`ï¼›å¦‚æœ`fabs(num) < t*1.125`ï¼Œåˆ™`num = num > 0 ? 1 : -1`ï¼›å¦åˆ™`num = method != CV_TM_SQDIFF_NORMED ? 0 : 1`
   5. åœ¨ result çš„å¯¹åº”ä½ç½®ä¸Šæ›´æ–°è®¡ç®—å¥½çš„ç»“æœ
5. ç»“æŸè®¡ç®—

### è®¡ç®—å›¾åƒç§¯åˆ† integral()
- srcï¼šè¾“å…¥å›¾åƒä¸ºå†…è”å…¬å¼ï¼Œ8ä½æˆ–æµ®ç‚¹(32fæˆ–64f)
- sumï¼šå†…è”å…¬å¼çš„ç§¯åˆ†å›¾åƒï¼Œ32ä½æ•´æ•°æˆ–æµ®ç‚¹æ•°(32fæˆ–64f)
- sqsumï¼šå¹³æ–¹åƒç´ å€¼çš„ç§¯åˆ†å›¾åƒ;å®ƒæ˜¯å†…è”å…¬å¼ï¼ŒåŒç²¾åº¦æµ®ç‚¹(64f)æ•°ç»„
- tiltedï¼šå¯¹æ—‹è½¬45åº¦çš„å›¾åƒç§¯åˆ†;å®ƒæ˜¯å…·æœ‰ä¸sumç›¸åŒæ•°æ®ç±»å‹çš„å†…è”å…¬å¼æ•°ç»„
- sdepthï¼šæœŸæœ›çš„ç§¯åˆ†æ·±åº¦å’Œå€¾æ–œç§¯åˆ†å›¾åƒCV_32S, CV_32Fï¼Œæˆ–CV_64F
- sqdepthï¼šå¹³æ–¹åƒç´ å€¼çš„ç§¯åˆ†å›¾åƒçš„æœŸæœ›æ·±åº¦CV_32Fæˆ–CV_64F

è¯¥å‡½æ•°ä¸ºæºå›¾åƒè®¡ç®—ä¸€ä¸ªæˆ–å¤šä¸ªç§¯åˆ†å›¾åƒï¼Œå¦‚ä¸‹æ‰€ç¤º:


![sum](https://latex.codecogs.com/png.latex?%5Ctexttt%7Bsum%7D%20%28X%2CY%29%20%3D%20%20%5Csum%20_%7Bx%3CX%2Cy%3CY%7D%20%20%5Ctexttt%7Bimage%7D%20%28x%2Cy%29 "sum")


![sqsum](https://latex.codecogs.com/png.latex?%5Ctexttt%7Bsqsum%7D%20%28X%2CY%29%20%3D%20%20%5Csum%20_%7Bx%3CX%2Cy%3CY%7D%20%20%5Ctexttt%7Bimage%7D%20%28x%2Cy%29%5E2 "sqsum")


![tilted](https://latex.codecogs.com/png.latex?%5Ctexttt%7Btilted%7D%20%28X%2CY%29%20%3D%20%20%5Csum%20_%7By%3CY%2Cabs%28x-X%2B1%29%20%5Cleq%20Y-y-1%7D%20%20%5Ctexttt%7Bimage%7D%20%28x%2Cy%29 "tilted")


ä½¿ç”¨è¿™äº›ç§¯åˆ†å›¾åƒï¼Œå¯ä»¥åœ¨æ’å®šçš„æ—¶é—´å†…è®¡ç®—å›¾åƒä¸Šç‰¹å®šçš„å‚ç›´æˆ–æ—‹è½¬çŸ©å½¢åŒºåŸŸçš„æ€»å’Œã€å¹³å‡å€¼å’Œæ ‡å‡†åå·®ï¼Œä¾‹å¦‚:


![formula](https://latex.codecogs.com/png.latex?%5Csum%20_%7Bx_1%20%5Cleq%20x%20%3C%20x_2%2C%20%20%5C%2C%20y_1%20%20%5Cleq%20y%20%3C%20y_2%7D%20%20%5Ctexttt%7Bimage%7D%20%28x%2Cy%29%20%3D%20%20%5Ctexttt%7Bsum%7D%20%28x_2%2Cy_2%29-%20%5Ctexttt%7Bsum%7D%20%28x_1%2Cy_2%29-%20%5Ctexttt%7Bsum%7D%20%28x_2%2Cy_1%29%2B%20%5Ctexttt%7Bsum%7D%20%28x_1%2Cy_1%29 "formula")


ä¾‹å¦‚ï¼Œå®ƒå¯ä»¥ä½¿ç”¨å¯å˜çª—å£å¤§å°è¿›è¡Œå¿«é€Ÿæ¨¡ç³Šæˆ–å¿«é€Ÿå—å…³è”ã€‚å¯¹äºå¤šé€šé“å›¾åƒï¼Œæ¯ä¸ªé€šé“çš„å’Œæ˜¯ç‹¬ç«‹ç´¯åŠ çš„ã€‚


![Image Integral](https://docs.opencv.org/3.4.7/integral.png "Image Integral")


[å‚è€ƒé“¾æ¥ 1](https://docs.rs/opencv/0.19.2/opencv/imgproc/fn.integral.html)


[å‚è€ƒé“¾æ¥ 2](https://aishack.in/tutorials/integral-images-opencv/)

### è®¡ç®—å¹³å‡å€¼å’Œæ ‡å‡†å·®
```c++
void cv::meanStdDev(
    InputArray src,
    OutputArray mean,
    OutputArray stddev,
    InputArray mask = noArray()
)
```
- è®¡ç®—æ•°ç»„å…ƒç´ çš„å¹³å‡å€¼å’Œæ ‡å‡†å·®
- å‡½æ•°cv::meanStdDevç‹¬ç«‹è®¡ç®—æ¯ä¸ªé€šé“æ•°ç»„å…ƒç´ çš„å¹³å‡å€¼å’Œæ ‡å‡†å·®Mï¼Œå¹¶é€šè¿‡è¾“å‡ºå‚æ•°è¿”å›:
  ![meanStdDev](https://github.com/JasmineCAicai/Unique-Graphics/blob/master/meanStdDev.png "meanStdDev")
- å½“æ‰€æœ‰æ©ç å…ƒç´ éƒ½ä¸º0æ—¶ï¼Œå‡½æ•°è¿”å›`mean=stddev=Scalar::all(0)`
- è®¡ç®—å‡ºçš„æ ‡å‡†å·®åªæ˜¯å®Œå…¨å½’ä¸€åŒ–åæ–¹å·®çŸ©é˜µçš„å¯¹è§’çº¿
  - å¦‚æœéœ€è¦å®Œæ•´çš„çŸ©é˜µï¼Œå¯ä»¥å°†å¤šé€šé“æ•°ç»„ M x N é‡å¡‘ä¸ºå•é€šé“æ•°ç»„ M*N x mtx.channels()
  - ä»…å½“çŸ©é˜µæ˜¯è¿ç»­çš„æ—¶å€™æ‰å¯èƒ½
  - ç„¶åå°†è¯¥çŸ©é˜µä¼ é€’ç»™ calcCovarMatrix


[å‚è€ƒé“¾æ¥](https://docs.opencv.org/3.4/d2/de8/group__core__array.html#ga846c858f4004d59493d7c6a4354b301d)

### DBL_EPSILON 2.2204460492503131e-16
